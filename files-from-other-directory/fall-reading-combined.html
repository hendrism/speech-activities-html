<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fall Reading Stories</title>
    <style>
        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(to bottom, #fef5e7, #fdebd0);
            min-height: 100vh;
        }
        h1 {
            color: #d35400;
            text-align: center;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .navigation {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 3px solid #e67e22;
            text-align: center;
        }
        .nav-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background 0.3s;
        }
        .nav-btn:hover {
            background: #e67e22;
        }
        .nav-btn.active {
            background: #d35400;
            transform: scale(1.1);
        }
        .question-toggle {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 3px solid #9b59b6;
            text-align: center;
        }
        .toggle-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background 0.3s;
        }
        .toggle-btn:hover {
            background: #8e44ad;
        }
        .toggle-btn.active {
            background: #6c3483;
            transform: scale(1.05);
        }
        .toggle-label {
            display: block;
            color: #6c3483;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .story {
            background: white;
            padding: 25px;
            margin: 30px 0;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 3px solid #e67e22;
            display: none;
        }
        .story.active {
            display: block;
        }
        h2 {
            color: #e67e22;
            border-bottom: 3px solid #f39c12;
            padding-bottom: 10px;
        }
        .story-text {
            line-height: 1.8;
            font-size: 1.1em;
            color: #2c3e50;
            background: #fef9f3;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .question {
            margin: 20px 0;
            padding: 15px;
            background: #fff3e0;
            border-radius: 10px;
            border-left: 5px solid #ff9800;
        }
        .question-text {
            font-weight: bold;
            color: #e67e22;
            font-size: 1.15em;
            margin-bottom: 10px;
        }
        .help-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background 0.3s;
        }
        .help-btn:hover {
            background: #2980b9;
        }
        .help-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        .choices {
            margin-top: 15px;
            display: none;
        }
        .choice {
            background: white;
            border: 2px solid #3498db;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .choice:hover {
            background: #ebf5fb;
            transform: translateX(5px);
        }
        .choice.correct {
            background: #d5f4e6;
            border-color: #27ae60;
            font-weight: bold;
        }
        .choice.incorrect {
            background: #fadbd8;
            border-color: #e74c3c;
        }
        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            display: none;
        }
        .feedback.correct {
            background: #d5f4e6;
            color: #27ae60;
            display: block;
        }
        .feedback.incorrect {
            background: #fadbd8;
            color: #e74c3c;
            display: block;
        }
        .retelling-section {
            margin: 20px 0;
        }
        .retelling-prompt {
            margin: 20px 0;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 10px;
            border-left: 5px solid #4caf50;
        }
        .retelling-label {
            font-weight: bold;
            color: #2e7d32;
            font-size: 1.1em;
            margin-bottom: 10px;
            display: block;
        }
        .sentence-starter {
            color: #4caf50;
            font-weight: bold;
            font-size: 1.05em;
        }
        .retelling-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #4caf50;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            margin-top: 8px;
            resize: vertical;
            min-height: 60px;
        }
        .retelling-input:focus {
            outline: none;
            border-color: #2e7d32;
            background: #f1f8e9;
        }
        .next-btn-container {
            text-align: center;
            margin: 30px 0;
        }
        .next-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .next-btn:hover {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.3);
        }
        .next-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <h1>üçÇ Fall Reading Stories üçÅ</h1>
    
    <div class="navigation" id="navigation"></div>
    
    <div class="question-toggle">
        <span class="toggle-label">Question Type:</span>
        <button class="toggle-btn active" onclick="setQuestionType('basic')">Basic Questions</button>
        <button class="toggle-btn" onclick="setQuestionType('infer')">Inference Questions</button>
        <button class="toggle-btn" onclick="setQuestionType('retelling')">Retelling</button>
    </div>
    
    <div id="stories-container"></div>
    
    <div class="next-btn-container">
        <button class="next-btn" id="next-btn" onclick="nextStory()">Next Story ‚Üí</button>
    </div>

    <script>
        let currentStory = 0;
        let questionType = 'basic';
        
        const stories = [
            {
                title: "Apple Picking Day",
                text: [
                    "Liam and his mom go to the apple farm.",
                    "They see big red apples on the trees.",
                    "Liam picks apples and puts them in a basket.",
                    "The air feels cool and smells sweet.",
                    "They eat warm apple pie when they get home."
                ],
                retellingPrompts: [
                    "Liam and his mom",
                    "They picked",
                    "The farm had",
                    "At home, they"
                ],
                basicQuestions: [
                    {
                        q: "Who goes to the farm?",
                        correct: "Liam and mom",
                        wrong: ["Liam and dad", "Mia's class", "Emma's sister"]
                    },
                    {
                        q: "What do they pick?",
                        correct: "Apples",
                        wrong: ["Pumpkins", "Leaves", "Corn"]
                    },
                    {
                        q: "Where do they go?",
                        correct: "Apple farm",
                        wrong: ["Pumpkin patch", "Park", "School"]
                    },
                    {
                        q: "When do they go?",
                        correct: "During day",
                        wrong: ["At night", "In winter", "Before sunrise"]
                    }
                ],
                inferQuestions: [
                    {
                        q: "Why does it smell sweet?",
                        correct: "The apples",
                        wrong: ["Flowers", "Grass", "Baking"]
                    },
                    {
                        q: "How does Liam feel?",
                        correct: "Happy",
                        wrong: ["Sad", "Angry", "Scared"]
                    },
                    {
                        q: "What season is it?",
                        correct: "Fall",
                        wrong: ["Summer", "Winter", "Spring"]
                    },
                    {
                        q: "Why make pie?",
                        correct: "Used fresh apples",
                        wrong: ["Bought apples", "Don't like apples", "Wanted cookies"]
                    }
                ]
            },
            {
                title: "The Pumpkin Patch",
                text: [
                    "Mia and her class visit the pumpkin patch.",
                    "She looks for a small, round pumpkin.",
                    "Her friend finds a big, lumpy one.",
                    "They ride on a hay wagon together.",
                    "Everyone laughs and waves to the farmer."
                ],
                retellingPrompts: [
                    "Mia's class",
                    "Mia wanted",
                    "They rode",
                    "Everyone was"
                ],
                basicQuestions: [
                    {
                        q: "Who goes to the pumpkin patch?",
                        correct: "Mia's class",
                        wrong: ["Mia's mom", "Caleb's dad", "Carlos's family"]
                    },
                    {
                        q: "What does Mia look for?",
                        correct: "Small pumpkin",
                        wrong: ["Big pumpkin", "Red apples", "Yellow leaves"]
                    },
                    {
                        q: "Where do they ride?",
                        correct: "Hay wagon",
                        wrong: ["Bus", "Big slide", "Corn maze"]
                    },
                    {
                        q: "When do they visit?",
                        correct: "School day",
                        wrong: ["After school", "At night", "In summer"]
                    }
                ],
                inferQuestions: [
                    {
                        q: "Why ride on wagon?",
                        correct: "To get around",
                        wrong: ["They're tired", "It's raining", "Can't walk"]
                    },
                    {
                        q: "How does Mia feel?",
                        correct: "Happy",
                        wrong: ["Sad", "Angry", "Bored"]
                    },
                    {
                        q: "Why wave to farmer?",
                        correct: "Say thank you",
                        wrong: ["They're leaving", "Need help", "They're angry"]
                    },
                    {
                        q: "What do with pumpkins?",
                        correct: "Carve them",
                        wrong: ["Throw away", "Plant them", "Give back"]
                    }
                ]
            },
            {
                title: "Leaves Falling Down",
                text: [
                    "Caleb walks in the park with his dad.",
                    "The trees have red, orange, and yellow leaves.",
                    "He kicks the leaves and watches them fly.",
                    "They take a picture by a tall tree.",
                    "The wind makes the leaves dance."
                ],
                retellingPrompts: [
                    "Caleb and his dad",
                    "The leaves",
                    "Caleb played with",
                    "They took"
                ],
                basicQuestions: [
                    {
                        q: "Who walks in the park?",
                        correct: "Caleb and dad",
                        wrong: ["Caleb and mom", "Liam and mom", "Evan's friends"]
                    },
                    {
                        q: "What color are the leaves?",
                        correct: "Red, orange, yellow",
                        wrong: ["Green and brown", "Purple and pink", "Only red"]
                    },
                    {
                        q: "Where do they take a picture?",
                        correct: "By tall tree",
                        wrong: ["Apple farm", "Hay wagon", "Corn maze"]
                    },
                    {
                        q: "When do leaves fall?",
                        correct: "In fall",
                        wrong: ["In spring", "In summer", "In winter"]
                    }
                ],
                inferQuestions: [
                    {
                        q: "Why are leaves colorful?",
                        correct: "Fall colors",
                        wrong: ["Someone painted", "Trees sick", "Always colorful"]
                    },
                    {
                        q: "How does Caleb feel?",
                        correct: "Happy",
                        wrong: ["Sad", "Angry", "Scared"]
                    },
                    {
                        q: "Why take picture?",
                        correct: "Remember day",
                        wrong: ["Camera broken", "They have to", "They're lost"]
                    },
                    {
                        q: "Why leaves dance?",
                        correct: "Wind blows",
                        wrong: ["Leaves alive", "Shaking trees", "Magic"]
                    }
                ]
            },
            {
                title: "Hot Chocolate Time",
                text: [
                    "Emma feels cold after school.",
                    "Her sister makes hot chocolate with marshmallows.",
                    "They sit on the couch under a blanket.",
                    "They watch the rain fall outside.",
                    "The drink warms their hands and hearts."
                ],
                retellingPrompts: [
                    "Emma felt",
                    "Her sister made",
                    "They sat",
                    "The hot chocolate"
                ],
                basicQuestions: [
                    {
                        q: "Who makes hot chocolate?",
                        correct: "Emma's sister",
                        wrong: ["Emma's mom", "Emma's dad", "Emma's brother"]
                    },
                    {
                        q: "What do they drink?",
                        correct: "Hot chocolate",
                        wrong: ["Apple cider", "Cold milk", "Orange juice"]
                    },
                    {
                        q: "Where do they sit?",
                        correct: "On couch",
                        wrong: ["Kitchen table", "In park", "Hay wagon"]
                    },
                    {
                        q: "When do they drink?",
                        correct: "After school",
                        wrong: ["Before school", "During lunch", "At midnight"]
                    }
                ],
                inferQuestions: [
                    {
                        q: "Why is Emma cold?",
                        correct: "Cold day",
                        wrong: ["Has fever", "House broken", "Forgot coat"]
                    },
                    {
                        q: "Why sit under blanket?",
                        correct: "Stay warm",
                        wrong: ["Hide", "No chairs", "They're sleepy"]
                    },
                    {
                        q: "How do they feel?",
                        correct: "Warm and happy",
                        wrong: ["Cold and sad", "Angry", "Lonely"]
                    },
                    {
                        q: "Why warm their hearts?",
                        correct: "Feel loved",
                        wrong: ["Too hot", "Hearts cold", "They're sick"]
                    }
                ]
            },
            {
                title: "Raking the Yard",
                text: [
                    "Mr. Lee and his students rake the school yard.",
                    "The leaves make a giant pile.",
                    "Everyone jumps into the pile and laughs.",
                    "They take turns using the rake.",
                    "The yard looks clean when they finish."
                ],
                retellingPrompts: [
                    "Mr. Lee's students",
                    "They made ",
                    "Everyone ",
                    "At the end, the yard"
                ],
                basicQuestions: [
                    {
                        q: "Who rakes the yard?",
                        correct: "Mr. Lee's students",
                        wrong: ["Mr. Lee's family", "The farmer", "Carlos's brother"]
                    },
                    {
                        q: "What do they jump into?",
                        correct: "Leaf pile",
                        wrong: ["Pumpkin pile", "Apple pile", "Snow pile"]
                    },
                    {
                        q: "Where do they rake?",
                        correct: "School yard",
                        wrong: ["Apple farm", "Park", "Corn maze"]
                    },
                    {
                        q: "When is yard clean?",
                        correct: "When finished",
                        wrong: ["Before start", "In morning", "Never"]
                    }
                ],
                inferQuestions: [
                    {
                        q: "Why rake yard?",
                        correct: "Clean up leaves",
                        wrong: ["Mr. Lee mean", "Find something", "They're bored"]
                    },
                    {
                        q: "How do students feel?",
                        correct: "Happy",
                        wrong: ["Sad", "Angry", "Scared"]
                    },
                    {
                        q: "Why jump in pile?",
                        correct: "For fun",
                        wrong: ["They fell", "Mr. Lee said", "They're fighting"]
                    },
                    {
                        q: "What season is it?",
                        correct: "Fall",
                        wrong: ["Spring", "Summer", "Winter"]
                    }
                ]
            },
            {
                title: "Football Game Fun",
                text: [
                    "Carlos goes to a football game with his family.",
                    "He cheers for the red team.",
                    "They eat popcorn and drink warm cider.",
                    "The players run fast across the field.",
                    "It gets dark when the game ends."
                ],
                retellingPrompts: [
                    "Carlos and his family",
                    "Carlos cheered for",
                    "They ate and drank",
                    "It was"
                ],
                basicQuestions: [
                    {
                        q: "Who goes to the game?",
                        correct: "Carlos's family",
                        wrong: ["Carlos's class", "Carlos alone", "Mr. Lee's students"]
                    },
                    {
                        q: "What color is the team?",
                        correct: "Red",
                        wrong: ["Blue", "Green", "Yellow"]
                    },
                    {
                        q: "Where do they watch?",
                        correct: "Football field",
                        wrong: ["At home", "At school", "At park"]
                    },
                    {
                        q: "When does it get dark?",
                        correct: "Game ends",
                        wrong: ["Game starts", "At halftime", "In morning"]
                    }
                ],
                inferQuestions: [
                    {
                        q: "Why get dark?",
                        correct: "Game until evening",
                        wrong: ["There's storm", "Lights broke", "Turned off sun"]
                    },
                    {
                        q: "How does Carlos feel?",
                        correct: "Excited",
                        wrong: ["Sad", "Angry", "Scared"]
                    },
                    {
                        q: "Why eat and drink?",
                        correct: "Part of fun",
                        wrong: ["No breakfast", "Out of food", "They must"]
                    },
                    {
                        q: "What time does game end?",
                        correct: "Evening",
                        wrong: ["Morning", "Noon", "Afternoon"]
                    }
                ]
            },
            {
                title: "Scarecrow in the Garden",
                text: [
                    "A scarecrow stands tall in the garden.",
                    "It wears a hat and an old plaid shirt.",
                    "The wind moves its arms a little bit.",
                    "Crows fly away when they see it.",
                    "The farmer smiles at his good work."
                ],
                retellingPrompts: [
                    "There was a",
                    "The scarecrow",
                    "When birds came close, they",
                    "The farmer "
                ],
                basicQuestions: [
                    {
                        q: "Who made the scarecrow?",
                        correct: "The farmer",
                        wrong: ["Mr. Lee", "Carlos", "Liam's mom"]
                    },
                    {
                        q: "What does it wear?",
                        correct: "Hat and shirt",
                        wrong: ["Crown and cape", "Orange sweater", "Football uniform"]
                    },
                    {
                        q: "Where does it stand?",
                        correct: "In garden",
                        wrong: ["Corn maze", "Pumpkin patch", "In park"]
                    },
                    {
                        q: "When do crows fly away?",
                        correct: "See scarecrow",
                        wrong: ["When raining", "Gets dark", "In morning"]
                    }
                ],
                inferQuestions: [
                    {
                        q: "Why make scarecrow?",
                        correct: "Scare birds",
                        wrong: ["Have friend", "Was bored", "Sell it"]
                    },
                    {
                        q: "Why crows fly away?",
                        correct: "Think it's person",
                        wrong: ["Find food", "Don't like gardens", "Farmer chased"]
                    },
                    {
                        q: "How does farmer feel?",
                        correct: "Proud",
                        wrong: ["Sad", "Angry", "Scared"]
                    },
                    {
                        q: "Why arms move?",
                        correct: "Light materials",
                        wrong: ["Scarecrow alive", "Arms broken", "Farmer moves"]
                    }
                ]
            },
            {
                title: "Fall Festival",
                text: [
                    "Nora's family goes to the fall festival downtown.",
                    "She eats caramel apples and popcorn.",
                    "Her brother rides the big slide.",
                    "They dance to the music and play games.",
                    "The lights shine when the sun goes down."
                ],
                retellingPrompts: [
                    "Nora's family",
                    "Nora ate",
                    "Her brother",
                    "They"
                ],
                basicQuestions: [
                    {
                        q: "Who goes to festival?",
                        correct: "Nora's family",
                        wrong: ["Nora's class", "Nora's friends", "Nora alone"]
                    },
                    {
                        q: "What does Nora eat?",
                        correct: "Caramel apples",
                        wrong: ["Hot chocolate", "Pumpkin pie", "Apple pie"]
                    },
                    {
                        q: "Where is festival?",
                        correct: "Downtown",
                        wrong: ["At school", "Apple farm", "In park"]
                    },
                    {
                        q: "When do lights shine?",
                        correct: "Sun goes down",
                        wrong: ["In morning", "At noon", "Never"]
                    }
                ],
                inferQuestions: [
                    {
                        q: "Why go to festival?",
                        correct: "Have fun",
                        wrong: ["They must", "They're lost", "It's raining"]
                    },
                    {
                        q: "How does Nora feel?",
                        correct: "Happy",
                        wrong: ["Sad", "Angry", "Tired"]
                    },
                    {
                        q: "Why lights shine?",
                        correct: "See in dark",
                        wrong: ["By accident", "Scare people", "It's Christmas"]
                    },
                    {
                        q: "When do they leave?",
                        correct: "Evening",
                        wrong: ["Early morning", "Noon", "After lunch"]
                    }
                ]
            },
            {
                title: "The Corn Maze",
                text: [
                    "Evan and his friends go in the corn maze.",
                    "The corn is taller than they are!",
                    "They follow signs to find the way out.",
                    "They laugh when they get lost.",
                    "At the end, they eat pumpkin donuts."
                ],
                retellingPrompts: [
                    "Evan and his friends",
                    "The corn was",
                    "They",
                    "After the maze, they"
                ],
                basicQuestions: [
                    {
                        q: "Who goes in maze?",
                        correct: "Evan's friends",
                        wrong: ["Evan's family", "Evan's class", "Evan's sister"]
                    },
                    {
                        q: "What do they eat?",
                        correct: "Pumpkin donuts",
                        wrong: ["Apple pie", "Caramel apples", "Hot chocolate"]
                    },
                    {
                        q: "Where do they walk?",
                        correct: "Corn maze",
                        wrong: ["In park", "Football field", "In garden"]
                    },
                    {
                        q: "When do they laugh?",
                        correct: "Get lost",
                        wrong: ["Find exit", "Before going", "Eat donuts"]
                    }
                ],
                inferQuestions: [
                    {
                        q: "Why laugh when lost?",
                        correct: "Having fun",
                        wrong: ["They're scared", "Being mean", "Want go home"]
                    },
                    {
                        q: "How do they feel?",
                        correct: "Happy",
                        wrong: ["Sad", "Angry", "Bored"]
                    },
                    {
                        q: "Why corn taller?",
                        correct: "Corn grows tall",
                        wrong: ["Corn magic", "Lying down", "On hill"]
                    },
                    {
                        q: "Why eat donuts?",
                        correct: "Treat for finishing",
                        wrong: ["They must", "No breakfast", "Donuts free"]
                    }
                ]
            },
            {
                title: "Sweater Weather",
                text: [
                    "Lila puts on her favorite orange sweater.",
                    "The morning air feels cool.",
                    "She walks to the bus stop with her friends.",
                    "They see fog on the grass.",
                    "Soon, the sun shines through the clouds."
                ],
                retellingPrompts: [
                    "Lila",
                    "She walked",
                    "The morning was",
                    "Finally,"
                ],
                basicQuestions: [
                    {
                        q: "Who wears a sweater?",
                        correct: "Lila",
                        wrong: ["Nora", "Emma", "Mia"]
                    },
                    {
                        q: "What does air feel like?",
                        correct: "Cool",
                        wrong: ["Hot", "Warm", "Freezing"]
                    },
                    {
                        q: "Where is Lila going?",
                        correct: "Bus stop",
                        wrong: ["Apple farm", "Football game", "Festival"]
                    },
                    {
                        q: "When does sun shine?",
                        correct: "Soon",
                        wrong: ["Never", "At night", "Before fog"]
                    }
                ],
                inferQuestions: [
                    {
                        q: "Why wear sweater?",
                        correct: "Air is cool",
                        wrong: ["Mom said", "Spilled on shirt", "Her birthday"]
                    },
                    {
                        q: "How does Lila feel?",
                        correct: "Happy",
                        wrong: ["Sad", "Angry", "Scared"]
                    },
                    {
                        q: "Why is there fog?",
                        correct: "Cool morning air",
                        wrong: ["Sprayed water", "It's smoke", "Grass burning"]
                    },
                    {
                        q: "What season is it?",
                        correct: "Fall",
                        wrong: ["Summer", "Winter", "Spring"]
                    }
                ]
            }
        ];

        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function setQuestionType(type) {
            questionType = type;
            
            const toggleBtns = document.querySelectorAll('.toggle-btn');
            toggleBtns.forEach(btn => {
                if ((type === 'basic' && btn.textContent.includes('Basic')) ||
                    (type === 'infer' && btn.textContent.includes('Inference')) ||
                    (type === 'retelling' && btn.textContent.includes('Retelling'))) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            goToStory(currentStory);
        }

        function createStory(story, index) {
            const storyDiv = document.createElement('div');
            storyDiv.className = index === 0 ? 'story active' : 'story';
            storyDiv.id = `story-${index}`;
            
            let html = `<h2>${story.title}</h2>`;
            html += `<div class="story-text">`;
            story.text.forEach(line => {
                html += `${line}<br>`;
            });
            html += `</div>`;
            
            if (questionType === 'retelling') {
                html += `<div class="retelling-section">`;
                html += `<div class="retelling-label" style="margin: 20px 0 15px 0; font-size: 1.2em; color: #2e7d32;">Now retell the story in your own words:</div>`;
                
                story.retellingPrompts.forEach((prompt, pIndex) => {
                    const promptId = `retell-${index}-${pIndex}`;
                    html += `
                        <div class="retelling-prompt">
                            <label class="retelling-label">${pIndex + 1}. <span class="sentence-starter">${prompt}</span></label>
                            <textarea class="retelling-input" id="${promptId}" placeholder="Type your answer here..."></textarea>
                        </div>
                    `;
                });
                
                html += `</div>`;
            } else {
                const questions = questionType === 'basic' ? story.basicQuestions : story.inferQuestions;
                
                questions.forEach((question, qIndex) => {
                    const questionId = `q-${index}-${qIndex}-${questionType}`;
                    html += `
                        <div class="question">
                            <div class="question-text">${question.q}</div>
                            <button class="help-btn" onclick="showHelp('${questionId}')">I need help</button>
                            <div class="choices" id="${questionId}-choices"></div>
                            <div class="feedback" id="${questionId}-feedback"></div>
                        </div>
                    `;
                });
            }
            
            storyDiv.innerHTML = html;
            return storyDiv;
        }

        function goToStory(index) {
            currentStory = index;
            
            const container = document.getElementById('stories-container');
            container.innerHTML = '';
            
            stories.forEach((story, i) => {
                container.appendChild(createStory(story, i));
            });
            
            const allStories = document.querySelectorAll('.story');
            allStories.forEach(story => story.classList.remove('active'));
            document.getElementById(`story-${index}`).classList.add('active');
            
            const navBtns = document.querySelectorAll('.nav-btn');
            navBtns.forEach((btn, i) => {
                if (i === index) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            const nextBtn = document.getElementById('next-btn');
            if (index === stories.length - 1) {
                nextBtn.textContent = 'All Done! üéâ';
                nextBtn.disabled = true;
            } else {
                nextBtn.textContent = 'Next Story ‚Üí';
                nextBtn.disabled = false;
            }
            
            window.scrollTo(0, 0);
        }

        function nextStory() {
            if (currentStory < stories.length - 1) {
                goToStory(currentStory + 1);
            }
        }

        function showHelp(questionId) {
            const parts = questionId.split('-');
            const storyIndex = parseInt(parts[1]);
            const qIndex = parseInt(parts[2]);
            const qType = parts[3];
            
            const questions = qType === 'basic' ? stories[storyIndex].basicQuestions : stories[storyIndex].inferQuestions;
            const question = questions[qIndex];
            
            const allChoices = [question.correct, ...question.wrong];
            const shuffled = shuffle(allChoices);
            
            const choicesDiv = document.getElementById(`${questionId}-choices`);
            choicesDiv.innerHTML = '';
            choicesDiv.style.display = 'block';
            
            shuffled.forEach(choice => {
                const choiceDiv = document.createElement('div');
                choiceDiv.className = 'choice';
                choiceDiv.textContent = choice;
                choiceDiv.onclick = () => checkAnswer(questionId, choice, question.correct);
                choicesDiv.appendChild(choiceDiv);
            });
            
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Help shown';
        }

        function checkAnswer(questionId, selected, correct) {
            const choicesDiv = document.getElementById(`${questionId}-choices`);
            const choices = choicesDiv.getElementsByClassName('choice');
            const feedbackDiv = document.getElementById(`${questionId}-feedback`);
            
            for (let choice of choices) {
                choice.style.pointerEvents = 'none';
                if (choice.textContent === correct) {
                    choice.classList.add('correct');
                } else if (choice.textContent === selected) {
                    choice.classList.add('incorrect');
                }
            }
            
            if (selected === correct) {
                feedbackDiv.textContent = '‚úì Great job! That\'s correct!';
                feedbackDiv.className = 'feedback correct';
            } else {
                feedbackDiv.textContent = '‚úó Not quite. The correct answer is highlighted in green.';
                feedbackDiv.className = 'feedback incorrect';
            }
        }

        const navigation = document.getElementById('navigation');
        
        stories.forEach((story, index) => {
            const navBtn = document.createElement('button');
            navBtn.className = index === 0 ? 'nav-btn active' : 'nav-btn';
            navBtn.textContent = `${index + 1}`;
            navBtn.onclick = () => goToStory(index);
            navigation.appendChild(navBtn);
        });
        
        const container = document.getElementById('stories-container');
        stories.forEach((story, index) => {
            container.appendChild(createStory(story, index));
        });
    </script>
</body>
</html>