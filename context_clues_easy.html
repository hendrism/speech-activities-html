<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context Clues Activity</title>
    <script>
        window.activityType = 'contextClues';
    </script>
</head>

<body>
    <div id="app-root"></div>

    <script type="module">
        import { contextClues } from './js/language-data.js';
        import { QuizEngine } from './js/quiz-engine.js';

        document.body.innerHTML = `
            <link rel="stylesheet" href="css/styles.css">
            <div class="app-container">
                <header class="main-header">
                    <div class="header-content">
                        <h1>üîç Context Clues Activity</h1>
                        <p>Use clues to find the meaning</p>
                    </div>
                </header>
                <main class="content-area">
                    <div id="activity-container"></div>
                </main>
            </div>
        `;

        const style = document.createElement('style');
        style.textContent = `
            .quiz-card { background: white; border-radius: 16px; padding: 32px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-top: 20px; }
            .question-text { font-size: 1.2em; margin-bottom: 20px; line-height: 1.6; }
            .target-word { color: var(--primary-color); font-weight: bold; background: #e0e7ff; padding: 2px 6px; border-radius: 4px; }
            .options-grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 20px; }
            .option-btn { padding: 15px; border: 2px solid #e2e8f0; border-radius: 8px; background: white; cursor: pointer; font-size: 1em; text-align: left; transition: all 0.2s; }
            .option-btn:hover { border-color: var(--primary-color); background: #f8fafc; }
            .option-btn.correct { background: #dcfce7; border-color: #22c55e; color: #166534; }
            .option-btn.incorrect { background: #fee2e2; border-color: #ef4444; color: #991b1b; }
            .feedback-area { margin-top: 20px; padding: 15px; border-radius: 8px; display: none; }
            .hint-box { margin-top: 15px; padding: 15px; background: #fffbeb; border-left: 4px solid #f59e0b; border-radius: 4px; display: none; }
            .controls { display: flex; justify-content: space-between; margin-top: 30px; }
        `;
        document.head.appendChild(style);

        const engine = new QuizEngine({
            data: contextClues,
            containerId: 'activity-container',
            onRender: (item, progress, engine) => {
                const card = document.createElement('div');
                card.className = 'quiz-card';

                const choices = engine.shuffleArray(item.choices);
                const correctAnswer = item.choices[0]; // Assuming first choice is correct based on data structure

                const optionsHtml = choices.map(choice =>
        \`<button class="option-btn" onclick="window.checkAnswer(this, '\${choice.replace(/'/g, "\\\\'")}', '\${correctAnswer.replace(/'/g, "\\\\'")}')">\${choice}</button>\`
                ).join('');

                card.innerHTML = \`
                    <div class="progress-container" style="margin-bottom: 20px;">
                        <div class="progress-bar" style="width: \${progress.percent}%"></div>
                        <div style="text-align: right; font-size: 0.9em; color: #666; margin-top: 5px;">
                            Question \${progress.current} of \${progress.total}
                        </div>
                    </div>
                    <div class="question-text">
                        \${item.text}
                    </div>
                    <div class="question-text" style="font-size: 1em; color: #666;">
                        What does <strong>\${item.word}</strong> mean?
                    </div>
                    <div class="hint-box" id="hint-box">
                        <strong>üí° Hint:</strong> \${item.hint}
                    </div>
                    <div class="options-grid">
                        \${optionsHtml}
                    </div>
                    <div class="feedback-area" id="feedback-area"></div>
                    <div class="controls">
                        <button class="btn btn-secondary" onclick="window.toggleHint()">üí° Hint</button>
                        <button class="btn btn-primary" id="next-btn" style="display:none;" onclick="window.nextQuestion()">Next ‚û°</button>
                    </div>
                \`;
                return card;
            }
        });

        window.checkAnswer = (btn, selected, correct) => {
            const allBtns = document.querySelectorAll('.option-btn');
            allBtns.forEach(b => b.disabled = true);
            const feedback = document.getElementById('feedback-area');
            feedback.style.display = 'block';

            if (selected === correct) {
                btn.classList.add('correct');
                feedback.textContent = "üéâ Correct! Great job.";
                feedback.style.background = "#dcfce7";
                feedback.style.color = "#166534";
            } else {
                btn.classList.add('incorrect');
                allBtns.forEach(b => { if (b.textContent === correct) b.classList.add('correct'); });
                feedback.textContent = "Not quite. The correct answer is highlighted.";
                feedback.style.background = "#fee2e2";
                feedback.style.color = "#991b1b";
            }
            document.getElementById('next-btn').style.display = 'block';
        };

        window.toggleHint = () => {
            const hint = document.getElementById('hint-box');
            hint.style.display = hint.style.display === 'none' ? 'block' : 'none';
        };

        window.nextQuestion = () => {
            engine.next();
        };
    </script>
</body>

</html>